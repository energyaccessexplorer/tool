<script type="module">
  import {
    envs as user_envs,
    extract as user_extract,
  } from './user.js';

  const subdomain = location.hostname.match(new RegExp(`^(.*).${EAE['settings'].domain}`))[1];

  let e;
  if (location.hostname.match(/localhost/))
    e = 'production';
  else {
    switch (subdomain) {
    case 'www':
      e = 'production';
      break;

    default:
      e = subdomain;
      break;
    }
  }

  if (e !== 'production') {
    if (!user_extract('id')) window.location = '/login';

    document.head.append(ce('link', null, { "rel": "stylesheet", "href": "/stylesheets/env.css" }))
    document.querySelector('[href="/"]').setAttribute('data-content', e);
  }

  let envs = user_envs();
  if (envs.indexOf(e) < 0) window.location = '/login';

  if (e === 'test') envs = ['test', 'production'];

  window.ENV = [...new Set(envs)];
</script>
